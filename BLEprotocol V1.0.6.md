# BLE智能工具柜协议

------



## 信息

- 版本: v1.0.6（0x01）
- 作者: 赵磊
- 邮箱: eezhaolei@163.com

## 修订


- 2018/9/12 初版制定 赵磊1.0	
- 2018/9/14 协议内容完善 赵磊1.0.1
- 2018/9/23 错误修正完善部分协议 赵磊1.0.2
- 2018/9/30 添加查询传感器相关指令 赵磊 1.0.3
- 2018/9/30 完成样机功能，完善协议说明 赵磊 1.0.4
- 2018/10/11添加查询日志协议（还不完善） 赵磊1.0.5
- 2018/11/14修改0x40,0x41指令 赵磊1.0.6

##目录
[TOC]

------



## 一、功能

- 设备基础信息管理
- 设备蓝牙解锁
- 设备蓝牙钥匙管理
- 设备RTC设置
- 设备日志读取

## 二、说明

- 

## 三、数据包结构

### 1、帧结构定义

| 帧头   | 功能码 | 长度   | 数据  | 校验 |
| :---: | :---: | :---: | :---: | :---: |
| 1Byte | 1Byte | 1Byte |0-16Byte    | 1Byte |
| 0xEF | 0x-- | 0x-- | 0x--    | 0x-- |

- 说明
**帧头：**数据长度为1字节，内容为固定值：0xEF。
**功能码：**数据长度为1字节，内容为功能码，范围0x00-0xDF(主功能码0x00-0x6F，辅功能码0x70-0xDF,0xE0-0xFF保留工厂使用)。
**长度：**数据长度为1字节，内容为payload数据长度，范围0x00-0x10
**数据：**数据长度可变，范围0x00-0xFF。
**校验：**数据长度1字节，内容为帧校验和，校验为数据包所有数据的和的低八位（即帧头-校验前一字节）
```c
/* 代码描述 */
typedef struct {
    uint8_t  magic;
    uint8_t  type;
    uint8_t length;
    char*   payload;
    int8_t  checksum;
} package_t;
```

### 2、功能码定义(type字段)

?	主功能码（加粗标注）主要用于主机（手机APP）>>>设备（工具车）的指令，辅功能码（主功能码+0x70）主要用于返回主功能码需要的数据等。

| 功能码   | 功能             | 说明                                               | 完成情况                                          | 是否确认                                      |
| -------- | ---------------- | -------------------------------------------------- | :------------------------------------------------: | -------------------------------------------------- |
| **0x00** | 读取设备信息     | 用于读取设备硬件信息     | √ | * |
| 0x70     | 信息回馈         | 向主机回馈硬件信息                   | √                  | *                 |
| **0x01** | 读取电源信息     | 用于主机向设备读取电源信息                         | √                        | *                       |
| 0x71     | 电源信息回馈     | 回馈                                               | √                                              | *                                             |
| **0x02** | 读取系统设置 | 用于读取系统设置 |  |  |
| 0x72 | 信息回馈 | 回馈系统设置 |  |  |
| **0x03** | 修改系统设置 | 用于修改系统设置 |  |  |
| 0x73 | 信息回馈 | 回馈 |  |  |
| **0x10** | 设备解锁         | 用于主机向设备发送解锁指令进行解锁操作             | √            | *           |
| 0x80     | 解锁回馈         | 设备收到解锁指令后的回馈                           | √                          | *                         |
| **0x11** | 设备锁定         | 用于主机向设备发送锁定指令进行解锁操作             | √            | *           |
| 0x81     | 锁定回馈         | 设备收到锁定指令后的回馈                           | √                          | *                         |
| **0x12** | 查询锁定状态     | 用于查询设备锁定状态                               | √ | * |
| 0x82     | 查询回馈         | 设备收到查询指令后的回馈                           | √ | * |
| **0x20** | 注册钥匙         | 用于主机向设备注册APP蓝牙钥匙操作 | √ | * |
| 0x90     | 注册回馈         | 用于设备注册后的回馈                               | √ | * |
| **0x21** | 注册RFID钥匙 | 用于注册RFID钥匙 | | * |
| 0x91 | 注册回馈 | 注册完成回馈消息 | | * |
| **0x22** | 注册蓝牙手环 | 用于注册蓝牙手环钥匙（暂时不用） | | * |
| 0x92 | 注册回馈 | 注册完成回馈消息 | | * |
| **0x25** | 注销钥匙         | 注销钥匙                                           |                                            | * |
| 0x95    | 注销回馈         |                                                    |                                                    | * |
| **0x26** | 查询已注册钥匙   | 查询设备已注册钥匙                                 |                                  | * |
| 0x96    | 查询回馈         |                                                    |                                                    | * |
| **0x27** | 清空钥匙         | 清空注册钥匙列表                                   |                                    | * |
| 0x97    | 清空回馈         |                                                    |                                                    | * |
| **0x30** | 查询设备RTC      | 查询设备RTC信息                                    | √ | * |
| 0xA0     | RTC回馈          | 回馈RTC信息                                        | √ | * |
| **0x31** | 更新设备RTC      | 更新设备RTC信息                                    | √ | * |
| 0xA1     | 更新回馈         |                                                    | √ | * |
| **0x32** | 传感器校准       | 校准传感器                                         |                                          |                                          |
| 0xA2    | 校准回馈         |                                                   |                                                   |                                                   |
| **0x40** | 工具车总状态查询  | 查询工具车总状态，必须上电1分钟后查询 | √ | * |
| 0xB0     | 工具状态回馈     |                                                    | √ | * |
| **0x41** | 抽屉状态查询 | 查询指定层抽屉的状态 | √ | * |
| 0xB1 | 抽屉状态回馈 |  |√| * |
| **0x50** | 查询锁工作日志   | 查询解锁，上锁的工作日志                           |                            |                            |
| 0xC0     | 回馈日志         |                                                    |                                                    |                                                    |
| **0x51** | 工作日志查询成功 | 工作日志查询成功删除指定锁工作日志                         |                                  |                                  |
| 0xC1     |      |                                                    |                                                    |                                                    |
| **0x52** | 清空锁工作日志   | 删除所有锁工作日志                                 |                                  |                                  |
| 0xC2     | 回馈清空操作     |                                                    |                                                    |                                                    |
|0xFx|系统保留功能码|用于蓝牙设备信息通讯，不涉及到APP|√|*|




## 四、功能码说明

### 1、设备信息读取（*0x00*）

####a）主功能

- 设备信息读取指令用于读取设备的基本信息，包括序列号，类型，厂家代码等。

- payload内容为空
####b）辅功能

* 电源信息回馈指令用于回馈电源信息

  | TYPE(设备型号) |VER（协议版本）|SER（设备序列号）|FAC（厂家代码）|PRO_DATE（生产日期）|
  | --------- |------------ |---------- |-------------|
  | 1Byte   |1Byte|4Byte|1Byte|6Byte|
  **TYPE：**该字节数据用于表示当前设备型号，型号对应待厂家定制。
  | TYPE |型号|
  | ---- |--|
  | 0x00 |测试型号  |
  | 0x01 |厂家型号 |
  **VER：**该字节数据用于表示设备协议版本，默认0x01。
  电池电量由0-100%表示，对应数据为0-100。

  **SER：**该数据使用4字节来表示设备序列号，SER=0x12345678。

  **FAC：**该数据使用4字节来表示生产厂家代码，默认0x01。

  **PRO_DATE：**该数据使用6字节来表示生产日期。

  |PRO_DATE|数据|
  |--|--|
  |[0]|年（00-99）|
  |[1]|月（1-12）|
  |[2]|日（1-31）|
  |[3]|时（0-23）|
  |[4]|分（0-59）|
  |[5]|秒（0-59）|
####c）示例
```c
发送查询指令（主机-->>设备）: 
{0xEF,0x00,0x00,0xEF}
回馈设备信息,型号01，协议版本V1.0，序列号0x12345678，生产厂家0x01，生产日期2018-9-10 12:00:00 
{0xEF,0x70,0x0D,0x00,0x01,0x12,0x34,0x56,0x78,0x01,0x12,0x01,0x0A,0x0C,0x00,0x00,0xAB}

```

### 2、电源信息读取（*0x01*）


####a）主功能

- 电源信息读取指令用于读取设备的电源信息，包括电源状态，电池电量，供电电压等。。

- payload内容为空?
####b）辅功能

* 电源信息回馈指令用于回馈电源信息

  | STA(状态) |BAT（电池电量）|VOL（系统电压）|
  | --------- |------------ |---------- |
  | 1Byte          |1Byte|2Byte|
  **STA：**该字节数据用于表示当前设备电源状态。
  | STA |功能|
  | ---- |--|
  | 0x01 |电池供电，正常  |
  | 0x02 |电池供电，电量低  |
  | 0x03 |充电状态|
  | 0x10 |电池错误 |
  | 0xA0 |协议错误  |
  **BAT：**该字节数据用于表示电池电量。
  电池电量由0-100%表示，对应数据为0-100。
  **VOL：**该字节数据用于表示系统当前电压。传输的数据为真实值的10倍。
  电压单位用V表示，50.0V对应数据为0-500。VOL[0]*256+VOL[1];  
####c）示例
```c
发送查询指令（主机-->>设备）: 
{0xEF,0x01,0x00,0xF0}
回馈电源信息,电池供电，正常，电量80%,电压12.5V（主机<<--设备）: 
{0xEF,0x71,0x04,0x03,0x50,0x00,0x7d,0x34}
```

### 3、设备解锁（*0x10*）

####a）主功能

- 设备解锁指令用于解锁设备（手机钥匙），手环钥匙解锁方式待定。

- payload内容如下

  |TPYE(钥匙类型)| ID(钥匙序列号) | KEY(钥匙密码) |
  | --|-------------- | ------------- |
  |1Byte| 5Byte          | 5Byte         |
  **TYPE:**使用1字节表示钥匙类型，不同类型的钥匙允许ID相同
  **ID：**使用5字节数据表示钥匙序列号，该号码唯一作为身份识别。
  **KEY：**使用5字节数据表示钥匙密码，该密码暂时不用。
  钥匙类型如下表：

  |TYPE|钥匙类型|说明|
  |--|--|--|
  |0x01|手机APP|APP解锁使用这个类型的钥匙|
  |0x02|蓝牙手环|待定|
  |0x03|RFID卡|待定|

####b）辅功能

* 设备解锁回馈指令用于主机发送解锁指令操作后的回馈

  | REC(回馈) |
  | -------------- |
  | 1Byte          |
  **REC：**该字节数据用于表示操作完成后的返回信息。

  | REC |功能|
  | ---- |--|
  | 0x01 |解锁成功  |
  | 0x02 |解锁失败，钥匙ID未注册  |
  | 0x03 |解锁失败，钥匙KEY错误 |
  | 0x04 |解锁失败，钥匙类型未知 |
  | 0x10 |解锁失败，电路故障  |
  | 0x11 |解锁失败，机械故障  |
  | 0xA0 |解锁失败，协议错误  |

####c）示例
```c
发送解锁指令，钥匙ID为0x0012345678，KEY为0x0011111111（主机-->>设备）: 
{0xEF,0x10,0x0B,0x01,0x00,0x12,0x34,0x56,0x78,0x00,0x11,0x11,0x11,0x11,0x63}
回馈解锁指令，解锁成功（主机<<--设备）: 
{0xEF,0x80,0x01,0x01,0x71}
回馈解锁指令，解锁失败，钥匙ID未注册（主机<<--设备）: 
{0xEF,0x80,0x01,0x02,0x72}
回馈解锁指令，解锁失败，钥匙KEY错误（主机<<--设备）: 
{0xEF,0x80,0x01,0x03,0x73}
```
### 4、设备锁定（*0x11*）


####a）主功能

- 设备上锁指令用于锁定设备（手机钥匙），手环钥匙解锁方式待定。

- payload内容如下

  |TYPE(钥匙类型)| ID(钥匙序列号) |
  | ---|----------- |
  | 1Byte|5Byte          |

  **TYPE:**使用1字节表示钥匙类型，不同类型的钥匙允许ID相同
  **ID：**使用5字节数据表示钥匙序列号，锁定设备时该ID号可省略（这个指令暂时全部省略）。

####b）辅功能

* 设备解锁回馈指令用于主机发送解锁指令操作后的回馈

  | REC(回馈) |
  | -------------- |
  | 1Byte          |
  **REC：**该字节数据用于表示操作完成后的返回信息。
  | REC |功能|
  | ---- |--|
  | 0x01 |锁定成功  |
  | 0x10 |锁定失败，电路故障  |
  | 0x11 |锁定失败，机械故障  |
  | 0xA0 |锁定失败，协议错误  |
  
####c）示例
```c
发送锁定指令，钥匙ID为0x0012345678（主机-->>设备）: 
{0xEF,0x11,0x06,0x01,0x00,0x12,0x34,0x56,0x78,0x1a}
/*当前测试使用这个{0xEF,0x11,0x00,0x00}*/
回馈锁定指令，锁定成功（主机<<--设备）: 
{0xEF,0x81,0x01,0x01,0x72}
回馈锁定指令，锁定失败，电路故障（主机<<--设备）: 
{0xEF,0x81,0x01,0x10,0x81}
回馈锁定指令，锁定失败，机械故障（主机<<--设备）: 
{0xEF,0x81,0x01,0x11,0x82}
```
### 5、查询锁定状态（*0x12*）

####a）主功能

- 查询锁定状态指令用于查询当前设备锁定状态

- payload内容为空?

####b）辅功能

* 锁定状态回馈指令用于回馈主机锁定状态

  | REC(回馈) |
  | -------------- |
  | 1Byte          |
  **REC：**该字节数据用于表示操作完成后的返回信息。
  | REC |功能|
  | ---- |--|
  | 0x01 |锁定状态  |
  | 0x02 |解锁状态  |
  | 0xA0 |协议错误  |
  
####c）示例
```c
发送查询锁定状态指令（主机-->>设备）: 
{0xEF,0x12,0x00,0x01}
回馈锁定状态，当前状态为锁定（主机<<--设备）: 
{0xEF,0x82,0x01,0x01,0x73}
```
### 6、注册钥匙（*0x20*）

####a）主功能

- 注册钥匙指令用于注册钥匙使用

- payload内容如下：
  |TYPE(钥匙类型)| ID(钥匙序列号) | KEY(钥匙密码) |VALID(有效期)|
  | -----|------- | --------- |------|
  |1Byte| 5Byte   | 5Byte     |3Byte |

  **TYPE:**使用1字节表示钥匙类型，不同类型的钥匙允许ID相同
  **ID：**使用4字节数据表示钥匙序列号，该号码唯一作为身份识别。
  **KEY：**使用4字节数据表示钥匙密码，该密码暂时不用。
  **VALID：**使用3字节数据表示钥匙使用期限，有效期精确到年月日，截止为当日的23：59，暂时为0。
  

####b）辅功能

* 回馈指令用于回馈注册结果

  | REC(回馈) |
  | -------------- |
  | 1Byte          |
  **REC：**该字节数据用于表示操作完成后的返回信息。
  | REC |功能|
  | ---- |--|
  | 0x01 |注册成功，新钥匙注册|
  | 0x02 |注册成功，更新旧钥匙  |
  | 0x03 |注册失败，钥匙列表已满  |
  | 0xA0 |协议错误  |
  
####c）示例
```c
发送注册钥匙指令，钥匙ID为0x0012345678，KEY为0x0011111111，有效期为2022-1-1（主机-->>设备）: 
{0xEF,0x20,0x0E,0x01,0x00,0x12,0x34,0x56,0x78,0x00,0x11,0x11,0x11,0x11,0x16,0x01,0x01,0x78}
回馈注册指令，新钥匙注册成功（主机<<--设备）: 
{0xEF,0x90,0x01,0x01,0x81}
```

### 7、注销钥匙（*0x21*）

####a）主功能

- 注销钥匙指令用于删除钥匙的使用权限

- payload内容如下：
  |TYPE(钥匙类型)| ID(钥匙序列号) |
  | ---|--------- |
  | 1Byte|5Byte        |
   **ID：**使用5字节数据表示钥匙序列号，删除钥匙时只需TYPE和ID就好了。 



####b）辅功能

* 回馈指令用于回馈删除结果

  | REC(回馈) |
  | -------------- |
  | 1Byte          |
  **REC：**该字节数据用于表示操作完成后的返回信息。
  | REC |功能|
  | ---- |--|
  | 0x01 |注销成功，钥匙失效|
  | 0x02 |注销失败，无此钥匙  |
  | 0xA0 |协议错误  |

####c）示例
```c
发送注销钥匙指令，钥匙ID为0x0012345678（主机-->>设备）: 
{0xEF,0x21,0x06,0x01,0x00,0x12,0x34,0x56,0x78,0x2B}
回馈注销指令，钥匙注销成功（主机<<--设备）: 
{0xEF,0x91,0x01,0x01,0x82}
```

### 8、清空所有钥匙（*0x22*）

####a）主功能

- 注销所有钥匙指令用于删除所有钥匙的使用权限

- payload内容为空 

####b）辅功能

* 回馈指令用于回馈删除结果

  | REC(回馈) |
  | -------------- |
  | 1Byte          |
  **REC：**该字节数据用于表示操作完成后的返回信息。
  | REC |功能|
  | ---- |--|
  | 0x01 |注销成功，所有钥匙失效|
  | 0x02 |注销失败，原因未知 |
  | 0xA0 |协议错误  |

####c）示例
```c
发送注销所有钥匙指令（主机-->>设备）: 
{0xEF,0x22,0x00,0x11}
回馈注销指令，所有钥匙注销成功（主机<<--设备）: 
{0xEF,0x92,0x01,0x01,0x83}
```


### 9、查询设备RTC信息（*0x30*）

####a）主功能

- 查询设备实时时钟信息

- payload内容为空 

####b）辅功能

* 回馈指令用于回馈删除结果

  | DATE(回馈) |
  | -------------- |
  | 6Byte          |
  **DATE：**该字节数据用于表示设备当前实时时钟，数据结构统一。


####c）示例
```c
发送查询RTC指令（主机-->>设备）: 
{0xEF,0x30,0x00,0x1F}
回馈RTC信息，当前设备RTC值为，2008-1-1 12:00:00（主机<<--设备）: 
{0xEF,0xA0,0x06,0x08,0x01,0x01,0x0C,0x00,0x00,0xA5}
```
### 10、更新RTC信息（*0x31*）

####a）主功能

- 更新设备实时时钟信息

- payload内容为6ByteRTC信息
-   | DATE(时间信息) |
  | -------------- |
  | 6Byte          |
  **DATE：**该字节数据用于表示当前实时时钟，数据结构统一。

####b）辅功能

* 回馈指令用于回馈更新结果结果
  | REC(回馈) |
  | -------------- |
  | 1Byte          |
  **REC：**该字节数据用于表示操作完成后的返回信息。

  | REC |功能|
  | ---- |--|
  | 0x01 |更新成功|
  | 0x02 |更新失败，RTC晶振错误 |
  | 0x03 |更新失败，RTC电池错误 |
  | 0x04 |更新失败，未知错误 |
  | 0xA0 |协议错误  |

####c）示例
```c
发送更新RTC指令，更新时间为2008-1-1 12:00:00（主机-->>设备）: 
{0xEF,0x31,0x06,0x08,0x01,0x01,0x0C,0x00,0x00,0x3C}
回馈更新RTC成功（主机<<--设备）: 
{0xEF,0xA1,0x01,0x01,0x92}
```
### 11、校准传感器指令（*0x32*）

####a）主功能

- 校准传感器，

- | FUNC(功能) | Value（传感器值） |
  | -------------- | -------------- |
  | 1Byte          | 2Byte  |
  **FUNC：**该字节数据用于表示校准传感器的功能。

  **Value：**2个字节表示传感器阀值，VAL[0]*256+VAL[1];

  | FUNC |功能|
  | ---- |--|
  | 0x01 |校准传感器无物体基准值|
  | 0x02 |校准传感器有物体基准值 |


####b）辅功能

* 回馈指令用于回馈删除结果

  | REC(回馈) |
  | -------------- |
  | 1Byte          |
  **REC：**该字节数据用于表示校准操作结果。
  | REC |功能|
  | ---- |--|
  | 0x01 |校准成功|
  | 0x02 |校准失败，有部分传感器有遮挡 |
  | 0x03 |校准失败，有传感器损坏 |
  | 0x04 |校准失败，未知错误 |
  | 0xA0 |协议错误  |

####c）示例
```c
 
```


### 12、工具总状态查询指令（*0x40*）

#### a）主功能

- 该指令用于查询工具的总体状态，必须在1分钟后查询，返回数据，包括工具车抽屉数，及抽屉地址
- payload内容为空

#### b）辅功能

- 回馈指令用于回馈删除结果

  | sta(状态) | page（分包指示） | val传感器值 |
  | -------------- | -------------- | -------------- |
  | 1Byte         | 1Byte    | 14Byte（max） |


  **sta：**暂不使用，保留为0x00

  **page：**（高4Bit）表示当前是第几页数据，（低4Bit）表示当前页数据有几个抽屉，每页支持7个抽屉数据。

  **val：** 表示抽屉的状态，page的值是几，这里的数据就有（几*2）字节。Val[0]表示硬件地址，Val[1]表示抽屉型号，对应抽屉型号表格对应。

例如：payload数据为：{0x00,0x12,0x01,0x04,0x02,0x0E}；B2表示该工具箱有2个抽屉，B3-4第一个抽屉的硬件地址是0x01，类型代码为0x04，内衬型号为F1ET04；B5-6表示第二个抽屉的硬件地址是0x02，类型代码为0x0E，内衬型号为F1ET14。



#### c）示例

```c
发送指令（主机-->>设备）: 
{0xEF,0x40,0x00,0x2F}
 
```

### 13、抽屉状态查询指令（*0x41*）

#### a）主功能

- 该指令用于查询该层工具的状态查询。
- payload内容为1字节，表示第几层抽屉，这个值不要超过上条指令的值，否则只返回错误代码0xA2，且无其他数据

#### b）辅功能

- 回馈指令用于回馈删除结果

  | sta(状态) | val传感器值 |
  | -------------- | -------------- |
  | 1Byte         | 15Byte（max） |

  **sta：**表示抽屉的状态，状态值
  **val：** 表示传感器值，每一位代表的数据根据内衬型号对应表所对应


例如：payload数据为：{0x01,0xFF,0xFF}；B1表示当前抽屉已经打开，11个传感器均有遮挡。

| sta  | 功能         |
| ---- | ------------ |
| 0x00 | 抽屉已关闭   |
| 0x01 | 抽屉已开     |
| 0xA1 | 抽屉层数错误 |
| 0xA2 | 故障         |
| 0xA0 | 协议错误     |

 

#### c）示例

```c
 发送指令（主机-->>设备）: 
{0xEF,0x41,0x01,0x01,0x32}
 
```

### 14、工作查询指令（*0x50）

#### a）主功能

- 该指令用于查询工具的使用日志。
- payload内容为空，且无其他数据

#### b）辅功能

- 回馈指令用于回馈删除结果

  | ser(流水号) | func（功能） | page（分包指示） | data（数据）  |
  | ----------- | ------------ | ---------------- | ------------- |
  | 2Byte       | 1Byte        | 1Byte            | 12Byte（max） |

  **ser：**2字节数据表示当前数据的流水号，用于去重，同一流水号代表同一操作日志

  **func：**表示日志类型，不同日志对应不同数据格式及类型。

  **page：**（高4Bit）表示当前是第几页数据，（低4Bit）表示共有多少页数据

  **data：** 表示数据，不同类型日志表示不同数据。

 

| func | 功能             |
| ---- | ---------------- |
| 0x01 | 解锁成功日志     |
| 0x02 | 未授权解锁失败日志     |
| 0x03 | 锁定成功日志     |
| 0x04 | 锁定时传感器状态 |

* 0x01:解锁成功日志，记录解锁卡号信息，时间信息。无须分包（0x11），格式如下

| 钥匙类型 | 钥匙ID | 解锁时间 |
| -------- | ------ | -------- |
| 1Byte    | 5Byte  | 5Byte    |

* 0x02:解锁失败日志，用于记录未授权用户解锁时的操作，记录解锁卡号信息，时间信息。无须分包（0x11），格式如下

| 钥匙类型 | 钥匙ID | 解锁时间 |
| -------- | ------ | -------- |
| 1Byte    | 5Byte  | 5Byte    |

* 0x03:锁定成功日志，记录锁定的用户信息，时间信息。无须分包（0x11），格式如下

| 钥匙类型 | 钥匙ID | 解锁时间 |
| -------- | ------ | -------- |
| 1Byte    | 5Byte  | 5Byte    |

* 0x04:锁定时传感器日志，记录锁定时的传感器状态，该数据流水号应该和锁定成功日志相同，格式如下，发送完此指令后，硬件会发送0x41对应的回馈指令，指令顺序按每层依次发送（间隔20ms）。

| 传送标识|后面的数据包数量 |
| -------- | -- |
| 1Byte    |1Byte|
传送标识为0x01表示，开始传送，增加后面数据包数量
传送标识为0x02表示，结束传送，后面数据为0。
传送完成后，APP应主动下发清空日志指令。


#### c）示例

```c
 发送指令（主机-->>设备）: 
{0xEF,0x41,0x00,0x30}
 
```



###14、日志记录成功指令（*0x51）
a）主功能

- 该指令用于查询日志后记录成功的指令，设备收到此指令后删除当前日志，并开始传送下一条。
- payload内容为空，且无其他数据

b）辅功能

- 无回馈指令

## 五、备注

- 协议中所涉及到的RTC完整信息统一格式如下，如只需日期取前3字节

  | DATE | 数据        |
  | ---- | ----------- |
  | [0]  | 年（00-99） |
  | [1]  | 月（1-12）  |
  | [2]  | 日（1-31）  |
  | [3]  | 时（0-23）  |
  | [4]  | 分（0-59）  |
  | [5]  | 秒（0-59）  |

测试解锁 

```c
解锁测试
{0xEF,0x10,0x0B,0x01,0xAA,0xBB,0xCC,0x00,0x01,0xAA,0xBB,0xCC,0x00,0x01,0x6F}
上锁测试
{0xEF,0x11,0x00,0x00}
```


##六、内部使用

**蓝牙连接指令：** 

{0xEF,0xF0,0x01,0x01,0xE1}//蓝牙已连接

{0xEF,0xF0,0x01,0x02,0xE2}//蓝牙已断开





